<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Pipeline</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    .column { min-width: 280px; }
  </style>
</head>
<body class="bg-gray-900 text-white">

  <div class="sticky top-0 z-50 bg-gray-900 p-4 text-center text-xl font-bold border-b border-gray-700">Sales Pipeline</div>

  <div class="overflow-x-auto pb-20">
    <div class="inline-flex gap-3 px-3 pt-3">

      <!-- 8 columns exactly like your screenshot -->
      <div class="column">
        <div class="bg-blue-600 p-2 text-center font-bold text-sm rounded-t">Chatbot</div>
        <div id="chatbot-lead" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

      <div class="column">
        <div class="bg-indigo-600 p-2 text-center font-bold text-sm rounded-t">Qualified</div>
        <div id="qualified" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

      <div class="column">
        <div class="bg-purple-600 p-2 text-center font-bold text-sm rounded-t">Appt Set</div>
        <div id="appt-set" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

      <div class="column">
        <div class="bg-green-600 p-2 text-center font-bold text-sm rounded-t">Showed</div>
        <div id="showed" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

      <div class="column">
        <div class="bg-yellow-600 p-2 text-center font-bold text-sm rounded-t">Wrote Up</div>
        <div id="wrote-up" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

      <div class="column">
        <div class="bg-orange-600 p-2 text-center font-bold text-sm rounded-t">Sold</div>
        <div id="sold" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

      <div class="column">
        <div class="bg-teal-600 p-2 text-center font-bold text-sm rounded-t">Delivered</div>
        <div id="delivered" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

      <div class="column">
        <div class="bg-red-700 p-2 text-center font-bold text-sm rounded-t">Lost</div>
        <div id="lost" class="bg-gray-800 rounded-b p-2 space-y-2"></div>
      </div>

    </div>
  </div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzleiQlkUV9lQ4jo0jDeY2Wi2hqazb25c6_1gtC2faim5rSYBIRfbBRErKopGOM6fnVEg/exec'

async function loadLeads() {
  const res = await fetch(SCRIPT_URL + '?t=' + Date.now())
  const leads = await res.json()
  document.querySelectorAll('[id]').forEach(c => c.innerHTML = '')

  leads.forEach((l, i) => {
    const card = document.createElement('div')
    card.dataset.row = i + 2
    card.className = 'bg-white text-black rounded-lg p-2 p-2.5 shadow cursor-move text-xs border border-gray-300'

    const name = l.Name || l['C1: Name'] || 'â€”'
    const phone = l.Phone || l['D1: Phone'] || ''
    const vehicle = l['Vehicle Type'] || l['G1: Vehicle Type'] || ''
    const budget = l.Budget || l['E1: Budget'] || ''
    const isHot = (l['Lead Type'] || l['A1: Lead Type'] || '').toLowerCase().trim() === 'hot'

    card.innerHTML = `
      <div class="font-bold truncate">${name}</div>
      <div class="text-gray-600 truncate">${phone}</div>
      <div class="truncate text-gray-800">${vehicle}</div>
      <span class="inline-block px-2.5 py-1 mt-1 text-xs font-bold rounded-full ${isHot ? 'bg-red-600 text-white' : 'bg-gray-500 text-white'}">
        ${isHot ? 'HOT' : 'WARM'}
      </span>
    `

    const stage = (l.Stage || l.stage || 'chatbot-lead').toLowerCase()
    const target = stage.includes('appt') ? 'appt-set' :
                   stage.includes('qualified') ? 'qualified' :
                   stage.includes('show') ? 'showed' :
                   stage.includes('wrote') ? 'wrote-up' :
                   stage.includes('sold') ? 'sold' :
                   stage.includes('delivered') ? 'delivered' :
                   stage.includes('lost') ? 'lost' :
                   'chatbot-lead'

    document.getElementById(target).appendChild(card)
  })

  const stages = ['chatbot-lead','qualified','appt-set','showed','wrote-up','sold','delivered','lost']
  stages.forEach(s => new Sortable(document.getElementById(s), {
    group: 'pipeline',
    animation: 120,
    onEnd: e => fetch(`${SCRIPT_URL}?row=${e.item.dataset.row}&stage=${e.to.id}`, {method: 'POST'})
  }))
}
loadLeads()
setInterval(loadLeads, 10000)
</script>
</body>
</html>